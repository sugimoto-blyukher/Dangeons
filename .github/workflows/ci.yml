name: CI (Processing)
on: [push, pull_request]

jobs:
  build-run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'   

      - name: Install Xvfb (headless GUI)
        run: sudo apt-get update && sudo apt-get install -y xvfb libxi6 libglu1-mesa

      - name: Download Processing
        run: |
          curl -L -o processing.tgz https://github.com/processing/processing4/releases/download/processing-1297-4.3.4/processing-4.3.4-linux-x64.tgz
          tar -xzvf processing.tgz
          echo "$PWD/processing-4.3.4" >> $GITHUB_PATH

      - name: Build sketch
        run: |
          processing-java --sketch=Dangeons  --output=Dangeons/build --build

      - name: Run sketch headless
        run: xvfb-run -a processing-java --sketch=Dangeons --force --output=Dangeons/build --run

      - name: Upload outputs (frames, logs, etc.)
        uses: actions/upload-artifact@v4
        with:
          name: outputs
          path: |
            Dangeons/output/**
            Dangeons/build/**
          if-no-files-found: warn
